<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Projek Kriptografi Kelompok 4</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">

  <style>
    :root {
      --bg:#0a0f1f;
      --bg-2:#111827;
      --panel:#0b1220;
      --accent:#3b82f6;
      --accent-2:#10b981;
      --text:#e2e8f0;
      --muted:#94a3b8;
      --radius:14px;
      --shadow:0 10px 30px rgba(0,0,0,.4);
      --mono:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,monospace;
    }

    *{box-sizing:border-box;margin:0;padding:0}

    body{
      font-family:"Inter",system-ui,Segoe UI,Roboto,Arial,sans-serif;
      background-color:var(--bg);
      color:var(--text);
      min-height:100vh;
      background-image:
        radial-gradient(circle at 80% 20%,rgba(59,130,246,0.15),transparent 60%),
        radial-gradient(circle at 15% 85%,rgba(16,185,129,0.12),transparent 60%),
        linear-gradient(160deg,#0a0f1f 0%,#0a0e1a 100%);
    }

    body::before{
      content:"";position:fixed;inset:0;
      background-image:linear-gradient(rgba(255,255,255,0.04) 1px,transparent 1px),
                       linear-gradient(90deg,rgba(255,255,255,0.04) 1px,transparent 1px);
      background-size:40px 40px;z-index:0;
    }

    section{position:relative;z-index:1}

    /* HOME */
    .home-wrapper{
      display:flex;align-items:center;justify-content:center;
      min-height:100vh;padding:24px;
    }
    .home-container{
      background:rgba(17,24,39,0.75);
      border:1px solid rgba(148,163,184,0.2);
      backdrop-filter:blur(14px);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:60px 50px;
      max-width:640px;width:100%;
      text-align:center;
    }
    .home-container h1{
      font-size:34px;font-weight:800;color:#f8fafc;margin-bottom:6px;
    }
    .home-container h2{
      font-size:20px;font-weight:700;color:#a5b4fc;margin-bottom:22px;
    }
    .home-container p.name{
      font-size:16px;color:#cbd5e1;margin:4px 0;
    }
    .home-desc{
      margin:32px 0 24px;
      color:#cbd5e1;
      font-size:17px;
    }
    .button-container{
      display:flex;flex-wrap:wrap;justify-content:center;gap:14px;
    }
    .choice-button{
      padding:14px 28px;
      border:1px solid #334155;
      background:transparent;
      border-radius:var(--radius);
      font-weight:600;
      font-size:16px;
      color:#f8fafc;
      min-width:180px;
      transition:.23s;
    }
    .choice-button:hover{
      background:#1e293b;
      border-color:#475569;
      transform:scale(1.02);
    }
    .footer-note{margin-top:36px;color:#64748b;font-size:14px}

    /* PAGE WRAPPER */
    .page-wrapper{display:none;padding:28px 20px 40px;}

    .page-header{
      display:flex;justify-content:space-between;align-items:center;
      max-width:1200px;margin:0 auto 24px;
    }

    .page-header h1{font-size:26px;font-weight:800;color:#dbeafe}

    .container{
      max-width:1200px;margin:auto;display:grid;gap:24px;
      grid-template-columns:1fr 1fr;
    }

    .card{
      background:linear-gradient(180deg,#0b1220,#101929);
      border:1px solid #1f2937;border-radius:16px;
      padding:22px;
      box-shadow:var(--shadow);
    }
    .card h2{
      font-size:18px;font-weight:800;color:#cbd5e1;margin-bottom:10px;
    }
    label{font-size:13px;color:#9fb2c7;font-weight:700;margin-bottom:6px;display:block;}
    textarea,input,select{
      width:100%;padding:12px;border:1px solid #334155;border-radius:12px;
      background:#0a0f1e;color:#f8fafc;font-size:15px;
    }
    textarea{min-height:110px}

    .btn{
      padding:10px 14px;border:1px solid #334155;background:#0b1220;color:#e2e8f0;
      border-radius:10px;font-weight:700;transition:.2s;
    }

    .btn:hover{background:#1e293b;border-color:#475569}

    /* RESULT BOX */
    .result-box{
      border:1px solid #1f2937;background:linear-gradient(180deg,#0a1222,#0b162a);
      border-radius:16px;padding:16px;color:#eef2ff;
    }

    .result-title{font-weight:800;margin-bottom:6px}
    .result-text{font-family:var(--mono);font-size:17px;line-height:1.6;word-wrap:anywhere}

    table{width:100%;border:1px solid #1f2937;border-collapse:collapse;font-size:14px}
    th,td{border:1px solid #1f2937;padding:8px}

    .grid-matrix{display:grid;grid-template-columns:repeat(5,1fr);gap:8px}
    .grid-matrix div{
      padding:10px;text-align:center;border-radius:10px;background:#0e172a;border:1px solid #1f2937
    }

    .muted{font-size:13px;color:#9ca3af}

    /* INSTRUKSI */
    .instruction-box{
      max-width:900px;
      width:95%;
      margin:0 auto 30px;
      padding:20px 26px;
      background:rgba(17,24,39,.75);
      border:1px solid rgba(148,163,184,.25);
      border-radius:16px;
      box-shadow:var(--shadow);
      backdrop-filter:blur(8px);
    }
    .instruction-title{
      font-size:18px;
      font-weight:800;
      margin-bottom:10px;
      color:#e5e7eb;
      text-align:center;
    }
    .instruction-box ol{
      margin-left:20px;
      line-height:1.65;
      color:#cbd5e1;
    }

    /* File info text */
    .file-info{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }
    /* ==== ELEGANT NAV BUTTON ==== */
.nav-button {
  padding: 10px 22px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 15px;
  border: 2px solid rgba(148,163,184,0.35);
  background: rgba(17,24,39,0.55);
  color: #e2e8f0;
  cursor: pointer;
  transition: .25s;
  backdrop-filter: blur(6px);
}

.nav-button:hover {
  transform: scale(1.06);
  border-color: #93c5fd;
  box-shadow: 0 0 12px rgba(59,130,246,0.35);
}

/* VARIASI BUTTON BIRU */
.nav-blue {
  border-color: rgba(96,165,250,0.35);
}
.nav-blue:hover {
  border-color: #3b82f6;
  box-shadow: 0 0 14px rgba(59,130,246,0.55);
  color: #93c5fd;
}

/* VARIASI BUTTON HIJAU */
.nav-green {
  border-color: rgba(52,211,153,0.35);
}
.nav-green:hover {
  border-color: #10b981;
  box-shadow: 0 0 14px rgba(16,185,129,0.55);
  color: #6ee7b7;
}

  </style>
</head>

<body>

<!-- HOME -->
<section id="pageHome" class="home-wrapper">
  <div class="home-container">
    <h1>Projek Kriptografi</h1>
    <h2>Kelompok 4</h2>

    <p class="name">Al Mutawakkil Paletari</p>
    <p class="name">Muh. Yusri</p>
    <p class="name">Muh. Farid Yusuf</p>
    <p class="name">Aliya Shafira</p>
    <p class="name">Hana Awaliyah</p>

    <p class="home-desc">Pilih algoritma untuk melakukan uji coba enkripsi &amp; dekripsi.</p>

    <div class="button-container">
      <button id="goAffine" class="choice-button">Affine Cipher</button>
      <button id="goPlayfair" class="choice-button">Playfair Cipher</button>
    </div>
  </div>
</section>



<!-- AFFINE -->
<section id="pageAffine" class="page-wrapper">

<div class="page-header">
    <h1>Affine Cipher</h1>

    <div style="display:flex; gap:12px;">
        <button class="nav-button nav-blue" onclick="showPage('pageHome')">
            ‚Üê Kembali ke Home
        </button>

        <button class="nav-button nav-green" onclick="showPage('pagePlayfair')">
            Ke Playfair Cipher ‚Üí
        </button>
    </div>
</div>

  </div>
  
  <!-- INSTRUKSI AFFINE -->
  <div class="instruction-box">
    <div class="instruction-title">üü© Instruksi Uji Coba Affine Cipher</div>
    <ol>
      <li>Masukkan teks ke kolom input atau unggah file teks (.txt).</li>
      <li>Isi kunci <b>a</b> dan <b>b</b>. (a harus relatif prima dengan 26).</li>
      <li>Pilih mode <b>Enkripsi</b> atau <b>Dekripsi</b>.</li>
      <li>Tekan tombol <b>Proses</b> untuk teks biasa.</li>
      <li>Tekan tombol <b>Proses File</b> untuk memproses isi file &amp; mengunduh hasilnya.</li>
    </ol>
  </div>

  <div class="container">
    <div class="card">
      <h2>Kontrol</h2>

      <label>Plaintext / Ciphertext</label>
      <textarea id="affineText" placeholder="Masukkan teks..."></textarea>

      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px;">
        <div><label>Kunci a</label><input id="affineA" type="number"></div>
        <div><label>Kunci b</label><input id="affineB" type="number"></div>
        <div>
          <label>Mode</label>
          <select id="affineMode">
            <option value="encrypt">Enkripsi</option>
            <option value="decrypt">Dekripsi</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <button class="btn" onclick="processAffine()">Proses</button>
        <button class="btn" onclick="reverseAffine()">‚áÑ Balik</button>

        <label class="btn" for="affineFile">Pilih File</label>
        <input id="affineFile" type="file" style="display:none" accept=".txt">
        <button class="btn" onclick="processAffineFile()">Proses File</button>
      </div>
      <div id="affineFileInfo" class="file-info">Belum ada file dipilih.</div>

      <p class="muted" style="margin-top:8px">
        Rumus enkripsi: (a¬∑x + b) mod 26 &nbsp;&nbsp; | &nbsp;&nbsp;
        Rumus dekripsi: a‚Åª¬π(x ‚àí b) mod 26
      </p>
    </div>

    <div class="card">
      <h2>Hasil &amp; Langkah</h2>

      <div id="affineResultBox" class="result-box" style="display:none">
        <div class="result-title">Hasil Affine</div>
        <div id="affineResult" class="result-text"></div>
        <div id="affineSummary" style="margin-top:8px;font-size:13px;color:#9ca3af"></div>

        <hr style="border-color:#1f2937;margin:12px 0">

        <div style="font-weight:700;margin-bottom:6px;color:#cbd5e1">Langkah Per Karakter</div>

        <div style="max-height:350px;overflow:auto;">
          <table id="affineSteps">
            <thead><tr><th>Karakter</th><th>x</th><th>Rumus</th><th>Hasil</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div id="affineEmpty" class="muted">-- belum ada hasil --</div>

    </div>
  </div>
</section>




<!-- PLAYFAIR -->
<section id="pagePlayfair" class="page-wrapper">

<div class="page-header">
    <h1>Playfair Cipher</h1>

    <div style="display:flex; gap:12px;">
        <button class="nav-button nav-blue" onclick="showPage('pageHome')">
            ‚Üê Kembali ke Home
        </button>

        <button class="nav-button nav-green" onclick="showPage('pageAffine')">
            ‚Üê Ke Affine Cipher
        </button>
    </div>
</div>


  <!-- INSTRUKSI PLAYFAIR -->
  <div class="instruction-box">
    <div class="instruction-title">üü¶ Instruksi Uji Coba Playfair Cipher</div>
    <ol>
      <li>Masukkan teks ke kolom input atau unggah file teks (.txt). Huruf J dianggap I.</li>
      <li>Masukkan kunci huruf (tanpa angka atau simbol).</li>
      <li>Pilih mode <b>Enkripsi</b> atau <b>Dekripsi</b>.</li>
      <li>Tekan tombol <b>Proses</b> untuk teks biasa.</li>
      <li>Tekan tombol <b>Proses File</b> untuk memproses isi file &amp; mengunduh hasilnya.</li>
    </ol>
  </div>

  <div class="container">

    <div class="card">
      <h2>Kontrol</h2>

      <label>Plaintext / Ciphertext</label>
      <textarea id="playfairText" placeholder="Masukkan teks..."></textarea>

      <div style="display:grid;grid-template-columns:2fr 1fr;gap:10px">
        <div><label>Kunci</label><input id="playfairKey" type="text"></div>
        <div>
          <label>Mode</label>
          <select id="playfairMode">
            <option value="encrypt">Enkripsi</option>
            <option value="decrypt">Dekripsi</option>
          </select>
        </div>
      </div>

      <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap;align-items:center">
        <button class="btn" onclick="processPlayfair()">Proses</button>
        <button class="btn" onclick="reversePlayfair()">‚áÑ Balik</button>

        <label class="btn" for="playfairFile">Pilih File</label>
        <input id="playfairFile" type="file" style="display:none" accept=".txt">
        <button class="btn" onclick="processPlayfairFile()">Proses File</button>
      </div>
      <div id="playfairFileInfo" class="file-info">Belum ada file dipilih.</div>

      <p class="muted" style="margin-top:8px">
        Playfair mengenkripsi pasangan huruf (bigram) pada matriks 5√ó5 (J ‚Üí I).
      </p>

    </div>

    <div class="card">
      <h2>Matriks &amp; Hasil</h2>

      <div id="matrixBox" class="result-box" style="display:none">
        <div class="result-title">Matriks 5√ó5</div>
        <div id="matrixTable" class="grid-matrix"></div>
      </div>

      <div id="playfairResultBox" class="result-box" style="display:none">
        <div class="result-title">Hasil Playfair</div>
        <div id="playfairResult" class="result-text"></div>
        <div id="playfairSummary" style="margin-top:8px;font-size:13px;color:#9ca3af"></div>

        <hr style="border-color:#1f2937;margin:12px 0">

        <div style="font-weight:700;margin-bottom:6px;color:#cbd5e1">Langkah</div>

        <div style="max-height:350px;overflow:auto">
          <table id="playfairSteps">
            <thead><tr><th>Pasangan</th><th>Aturan</th><th>Hasil</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div id="playfairEmpty" class="muted">-- belum ada hasil --</div>

    </div>

  </div>
</section>




<!-- JAVASCRIPT -->
<script>
  const sections = document.querySelectorAll('.page-wrapper,.home-wrapper');
  function resetAllPages() {
  // ===== RESET AFFINE =====
  document.getElementById("affineText").value = "";
  document.getElementById("affineA").value = "";
  document.getElementById("affineB").value = "";
  document.getElementById("affineMode").value = "encrypt";

  document.getElementById("affineResult").textContent = "";
  document.querySelector("#affineSteps tbody").innerHTML = "";
  document.getElementById("affineResultBox").style.display = "none";
  document.getElementById("affineEmpty").style.display = "block";

  document.getElementById("affineFile").value = "";
  document.getElementById("affineFileInfo").textContent = "Belum ada file dipilih.";


  // ===== RESET PLAYFAIR =====
  document.getElementById("playfairText").value = "";
  document.getElementById("playfairKey").value = "";
  document.getElementById("playfairMode").value = "encrypt";

  document.getElementById("playfairResult").textContent = "";
  document.querySelector("#playfairSteps tbody").innerHTML = "";
  document.getElementById("playfairResultBox").style.display = "none";
  document.getElementById("matrixBox").style.display = "none";
  document.getElementById("playfairEmpty").style.display = "block";

  document.getElementById("matrixTable").innerHTML = "";

  document.getElementById("playfairFile").value = "";
  document.getElementById("playfairFileInfo").textContent = "Belum ada file dipilih.";
}

function showPage(id){
  // sebelum pindah halaman ‚Üí reset semua isi
  resetAllPages();

  sections.forEach(s => s.style.display = 'none');
  document.getElementById(id).style.display = id === 'pageHome' ? 'flex' : 'block';
}


  document.getElementById('goAffine').onclick = ()=>showPage('pageAffine');
  document.getElementById('goPlayfair').onclick = ()=>showPage('pagePlayfair');

  // ==== util umum ====
  function downloadTextFile(filename, text){
    const blob = new Blob([text], {type: 'text/plain'});
    const url  = URL.createObjectURL(blob);
    const a    = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }

  function summarizeFileInfo(file){
    if(!file) return "Belum ada file dipilih.";
    const kb = (file.size/1024).toFixed(1);
    return `File: ${file.name} (${kb} KB)`;
  }

  // tampilkan nama file saat dipilih
  document.getElementById("affineFile").addEventListener("change", function(){
    document.getElementById("affineFileInfo").textContent = summarizeFileInfo(this.files[0]);
  });
  document.getElementById("playfairFile").addEventListener("change", function(){
    document.getElementById("playfairFileInfo").textContent = summarizeFileInfo(this.files[0]);
  });


  /* ========= AFFINE ========= */
  const ALPHA="ABCDEFGHIJKLMNOPQRSTUVWXYZ";
  const gcd=(a,b)=>b==0?a:gcd(b,a%b);

  function modInverse(a,m){
    a%=m;
    for(let x=1;x<m;x++) if((a*x)%m===1) return x;
    throw "tidak ada invers";
  }

  // fungsi asli affineCipher (tidak diubah secara logika)
  function affineCipher(text,a,b,mode){
    let res="",steps=[];
    for(let ch of text){
      const c=ch.toUpperCase();
      if(ALPHA.includes(c)){
        const x=ALPHA.indexOf(c);
        let y,calc;
        if(mode==="encrypt"){
          y=(a*x+b)%26;
          calc=`(${a}√ó${x}+${b}) mod 26 = ${y}`;
        } else {
          const inv=modInverse(a,26);
          y=(inv*(x-b+26))%26;
          calc=`(${inv}√ó(${x}-${b})) mod 26 = ${y}`;
        }
        const out=ALPHA[y];
        res+=ch===ch.toUpperCase()?out:out.toLowerCase();
        steps.push({char:ch,x,calc,out});
      } else {
        res+=ch;
      }
    }
    return{result:res,steps};
  }

  // helper: memproses affine dari teks, meng-update UI, mengembalikan info
  function runAffineOnText(text){
    const a=parseInt(document.getElementById("affineA").value);
    const b=parseInt(document.getElementById("affineB").value);
    const mode=document.getElementById("affineMode").value;

    if(isNaN(a) || isNaN(b)){
      alert("Isi kunci a dan b terlebih dahulu.");
      return null;
    }
    if(gcd(a,26)!==1){
      alert("Nilai a harus relatif prima terhadap 26 (misal 1,3,5,7,9,11,...).");
      return null;
    }

    const {result,steps}=affineCipher(text,a,b,mode);

    document.getElementById("affineResult").textContent=result;
    document.getElementById("affineSummary").innerHTML=
      `<b>Teks asli:</b> ${text||"-"}\n`+
      `<b>Mode:</b> ${mode}\n`+
      `<b>Kunci:</b> (${a}, ${b})\n`+
      `<b>Hasil:</b> ${result||"-"}`.replace(/\n/g,"<br>");

    const tbody=document.querySelector("#affineSteps tbody");
    tbody.innerHTML="";

    steps.forEach(s=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${s.char}</td><td>${s.x}</td><td>${s.calc}</td><td>${s.out}</td>`;
      tbody.appendChild(tr);
    });

    document.getElementById("affineEmpty").style.display="none";
    document.getElementById("affineResultBox").style.display="block";

    return {a,b,mode,text,result,steps};
  }

  function processAffine(){
    const text=document.getElementById("affineText").value;
    runAffineOnText(text);
  }

  function reverseAffine(){
    const modeEl=document.getElementById("affineMode");
    const result=document.getElementById("affineResult").textContent.trim();
    if(result) document.getElementById("affineText").value=result;
    modeEl.value = modeEl.value==="encrypt" ? "decrypt" : "encrypt";
    processAffine();
  }

  function processAffineFile(){
    const file=document.getElementById("affineFile").files[0];
    if(!file) return alert("Pilih file .txt terlebih dahulu!");
    if(!file.name.toLowerCase().endsWith(".txt")){
      if(!confirm("Format file bukan .txt. Tetap lanjut?")) return;
    }
    const reader=new FileReader();
    reader.onload=()=>{
      const text = reader.result;
      document.getElementById("affineText").value=text;     // tampil juga di textarea
      const info = runAffineOnText(text);
      if(!info) return;

      // buat laporan detail untuk di-download
      const lines = text.split(/\r\n|\n/).length;
      const detailLines = [
        "=== LAPORAN AFFINE CIPHER ===",
        "",
        `Nama file asal : ${file.name}`,
        `Ukuran file    : ${file.size} byte (${(file.size/1024).toFixed(1)} KB)`,
        `Jumlah baris   : ${lines}`,
        "",
        `Mode           : ${info.mode}`,
        `Kunci (a,b)    : (${info.a}, ${info.b})`,
        "",
        "=== TEKS ASLI ===",
        info.text,
        "",
        "=== HASIL PROSES ===",
        info.result,
        "",
        "=== LANGKAH PER KARAKTER ===",
        "Karakter | x | Rumus | Hasil",
        "---------------------------------------------"
      ];
      info.steps.forEach(s=>{
        detailLines.push(`${s.char} | ${s.x} | ${s.calc} | ${s.out}`);
      });

      const outName = file.name.replace(/\.txt$/i,"") +
        `_affine_${info.mode}.txt`;
      downloadTextFile(outName, detailLines.join("\n"));
    };
    reader.readAsText(file);
  }


  /* ========= PLAYFAIR ========= */
  function createMatrix(key){
    key=key.toUpperCase().replace(/J/g,"I");
    let seen="",letters=ALPHA.replace("J","");
    for(let ch of key+letters) if(/[A-Z]/.test(ch) && !seen.includes(ch)) seen+=ch;
    return Array.from({length:5},(_,i)=>seen.slice(i*5,i*5+5).split(""));
  }

  function findPos(m,ch){
    for(let i=0;i<5;i++)
      for(let j=0;j<5;j++)
        if(m[i][j]===ch) return[i,j];
    return[0,0];
  }

  // fungsi asli playfairCipher (logika tidak diubah)
  function playfairCipher(text,key,mode){
    const m=createMatrix(key);
    let pairs=[],steps=[],res="";
    text=text.toUpperCase().replace(/J/g,"I").replace(/[^A-Z]/g,"");

    for(let i=0;i<text.length;i+=2){
      let a=text[i],b=text[i+1]||"X";
      if(a===b){b="X";i--;}
      pairs.push([a,b]);
    }

    for(let [a,b] of pairs){
      const[r1,c1]=findPos(m,a);
      const[r2,c2]=findPos(m,b);
      let o1,o2,rule;

      if(r1===r2){
        o1=m[r1][(c1+(mode==="encrypt"?1:4))%5];
        o2=m[r2][(c2+(mode==="encrypt"?1:4))%5];
        rule=`Baris sama ‚Üí geser ${mode==="encrypt"?"kanan":"kiri"}`;
      }
      else if(c1===c2){
        o1=m[(r1+(mode==="encrypt"?1:4))%5][c1];
        o2=m[(r2+(mode==="encrypt"?1:4))%5][c2];
        rule=`Kolom sama ‚Üí geser ${mode==="encrypt"?"bawah":"atas"}`;
      }
      else{
        o1=m[r1][c2];
        o2=m[r2][c1];
        rule="Persegi ‚Üí tukar kolom";
      }

      res+=o1+o2;
      steps.push({pair:a+b,rule,out:o1+o2});
    }

    return{result:res,steps,matrix:m};
  }

  // helper: proses playfair & update UI
  function runPlayfairOnText(text){
    const key=document.getElementById("playfairKey").value;
    const mode=document.getElementById("playfairMode").value;

    if(!key || !/[A-Za-z]/.test(key)){
      alert("Isi kunci huruf terlebih dahulu.");
      return null;
    }

    const {result,steps,matrix}=playfairCipher(text,key,mode);

    document.getElementById("playfairResult").textContent=result;
    document.getElementById("playfairSummary").innerHTML=
      `<b>Teks asli:</b> ${text||"-"}\n`+
      `<b>Mode:</b> ${mode}\n`+
      `<b>Kunci:</b> ${key||"-"}\n`+
      `<b>Hasil:</b> ${result||"-"}`.replace(/\n/g,"<br>");

    const tbody=document.querySelector("#playfairSteps tbody");
    tbody.innerHTML="";
    steps.forEach(s=>{
      const tr=document.createElement("tr");
      tr.innerHTML=`<td>${s.pair}</td><td>${s.rule}</td><td>${s.out}</td>`;
      tbody.appendChild(tr);
    });

    const grid=document.getElementById("matrixTable");
    grid.innerHTML="";
    matrix.flat().forEach(c=>{
      const d=document.createElement("div");
      d.textContent=c;
      grid.appendChild(d);
    });

    document.getElementById("playfairEmpty").style.display="none";
    document.getElementById("matrixBox").style.display="block";
    document.getElementById("playfairResultBox").style.display="block";

    return {text,key,mode,result,steps,matrix};
  }

  function processPlayfair(){
    const text=document.getElementById("playfairText").value;
    runPlayfairOnText(text);
  }

  function reversePlayfair(){
    const modeEl=document.getElementById("playfairMode");
    const result=document.getElementById("playfairResult").textContent.trim();
    if(result) document.getElementById("playfairText").value=result;
    modeEl.value = modeEl.value==="encrypt" ? "decrypt" : "encrypt";
    processPlayfair();
  }

  function processPlayfairFile(){
    const file=document.getElementById("playfairFile").files[0];
    if(!file) return alert("Pilih file .txt terlebih dahulu!");
    if(!file.name.toLowerCase().endsWith(".txt")){
      if(!confirm("Format file bukan .txt. Tetap lanjut?")) return;
    }
    const reader=new FileReader();
    reader.onload=()=>{
      const text = reader.result;
      document.getElementById("playfairText").value=text;
      const info = runPlayfairOnText(text);
      if(!info) return;

      const lines = text.split(/\r\n|\n/).length;
      const detailLines = [
        "=== LAPORAN PLAYFAIR CIPHER ===",
        "",
        `Nama file asal : ${file.name}`,
        `Ukuran file    : ${file.size} byte (${(file.size/1024).toFixed(1)} KB)`,
        `Jumlah baris   : ${lines}`,
        "",
        `Mode           : ${info.mode}`,
        `Kunci          : ${info.key}`,
        "",
        "=== MATRIKS 5x5 ==="
      ];

      // tambahkan matriks
      for(let r=0;r<5;r++){
        detailLines.push(info.matrix[r].join(" "));
      }

      detailLines.push(
        "",
        "=== TEKS ASLI ===",
        info.text,
        "",
        "=== HASIL PROSES ===",
        info.result,
        "",
        "=== LANGKAH PER PASANGAN ===",
        "Pasangan | Aturan | Hasil",
        "---------------------------------------------"
      );

      info.steps.forEach(s=>{
        detailLines.push(`${s.pair} | ${s.rule} | ${s.out}`);
      });

      const outName = file.name.replace(/\.txt$/i,"") +
        `_playfair_${info.mode}.txt`;
      downloadTextFile(outName, detailLines.join("\n"));
    };
    reader.readAsText(file);
  }

  // tampilkan home di awal
  showPage('pageHome');
</script>

</body>
</html>
